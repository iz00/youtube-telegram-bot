<hr>

<div align="center">

  # Youtube Info Telegram Bot
  <img src="https://www.svgrepo.com/show/343537/youtube-player-multimedia-video-communication-interaction.svg" alt="YouTube icon" title="YouTube" height="60px"/>
  <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f91d.svg" alt="Handshake Emoji" height="40px"/>
  <img src="https://www.svgrepo.com/show/452115/telegram.svg" alt="Telegram icon" title="Telegram" height="55px"/>

  ######

  <a href="https://t.me/YouTubedlpHelperBot" alt="Run Telegram Bot"><img src="https://img.shields.io/badge/RUN-Telegram%20Bot-blue?logo=data:image/svg+xml;base64,PHN2ZyBpZD0iTGl2ZWxsb18xIiBkYXRhLW5hbWU9IkxpdmVsbG8gMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmlld0JveD0iMCAwIDI0MCAyNDAiPjxkZWZzPjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZWFyLWdyYWRpZW50IiB4MT0iMTIwIiB5MT0iMjQwIiB4Mj0iMTIwIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjMWQ5M2QyIi8+PHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjMzhiMGUzIi8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHRpdGxlPlRlbGVncmFtX2xvZ288L3RpdGxlPjxjaXJjbGUgY3g9IjEyMCIgY3k9IjEyMCIgcj0iMTIwIiBmaWxsPSJ1cmwoI2xpbmVhci1ncmFkaWVudCkiLz48cGF0aCBkPSJNODEuMjI5LDEyOC43NzJsMTQuMjM3LDM5LjQwNnMxLjc4LDMuNjg3LDMuNjg2LDMuNjg3LDMwLjI1NS0yOS40OTIsMzAuMjU1LTI5LjQ5MmwzMS41MjUtNjAuODlMODEuNzM3LDExOC42WiIgZmlsbD0iI2M4ZGFlYSIvPjxwYXRoIGQ9Ik0xMDAuMTA2LDEzOC44NzhsLTIuNzMzLDI5LjA0NnMtMS4xNDQsOC45LDcuNzU0LDAsMTcuNDE1LTE1Ljc2MywxNy40MTUtMTUuNzYzIiBmaWxsPSIjYTljNmQ4Ii8+PHBhdGggZD0iTTgxLjQ4NiwxMzAuMTc4LDUyLjIsMTIwLjYzNnMtMy41LTEuNDItMi4zNzMtNC42NGMuMjMyLS42NjQuNy0xLjIyOSwyLjEtMi4yLDYuNDg5LTQuNTIzLDEyMC4xMDYtNDUuMzYsMTIwLjEwNi00NS4zNnMzLjIwOC0xLjA4MSw1LjEtLjM2MmEyLjc2NiwyLjc2NiwwLDAsMSwxLjg4NSwyLjA1NSw5LjM1Nyw5LjM1NywwLDAsMSwuMjU0LDIuNTg1Yy0uMDA5Ljc1Mi0uMSwxLjQ0OS0uMTY5LDIuNTQyLS42OTIsMTEuMTY1LTIxLjQsOTQuNDkzLTIxLjQsOTQuNDkzcy0xLjIzOSw0Ljg3Ni01LjY3OCw1LjA0M0E4LjEzLDguMTMsMCwwLDEsMTQ2LjEsMTcyLjVjLTguNzExLTcuNDkzLTM4LjgxOS0yNy43MjctNDUuNDcyLTMyLjE3N2ExLjI3LDEuMjcsMCwwLDEtLjU0Ni0uOWMtLjA5My0uNDY5LjQxNy0xLjA1LjQxNy0xLjA1czUyLjQyNi00Ni42LDUzLjgyMS01MS40OTJjLjEwOC0uMzc5LS4zLS41NjYtLjg0OC0uNC0zLjQ4MiwxLjI4MS02My44NDQsMzkuNC03MC41MDYsNDMuNjA3QTMuMjEsMy4yMSwwLDAsMSw4MS40ODYsMTMwLjE3OFoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=" title="Use bot on Telegram" width="230"/></a>

  ### [Telegram Bot](https://core.telegram.org/bots) that gets informations on YouTube videos and playlists.

<hr>

</div>

## Built With

<table align="center">
  <tr>
    <td align="center">
			<a href="https://github.com/yt-dlp/yt-dlp" alt="yt-dlp Github repository">
				<img src="https://img.shields.io/badge/yt--dlp-FF2A2A?logo=youtube&logoColor=white" title="yt-dlp" height="30"/>
			</a>
    </td>
    <td>Used for validating and extracting metadata from YouTube videos and playlists.</td>
  </tr>
  <tr>
    <td align="center">
			<a href="https://developers.google.com/youtube/v3" alt="Youtube Data API website">
				<img src="https://img.shields.io/badge/YouTube%20Data%20API-FF0000?logo=youtube&logoColor=white" title="YouTube Data API" height="30"/>
			</a>
    </td>
    <td>Used for fetching additional YouTube data when yt-dlp was insufficient.</td>
  </tr>
  <tr>
    <td align="center">
			<a href="https://github.com/python-telegram-bot/python-telegram-bot" alt="python-telegram-bot Github repository">
				<img src="https://img.shields.io/badge/python--telegram--bot-3C78AA?logo=python&logoColor=white" title="python-telegram-bot" height="30"/>
			</a>
    </td>
    <td>Framework for creating the Telegram bot and handling conversations.</td>
  </tr>
  <tr>
    <td align="center">
			<a href="https://github.com/psf/black" alt="Black Github repository">
				<img src="https://img.shields.io/badge/black-000000?logo=python&logoColor=white" title="Black" height="30"/>
			</a>
    </td>
    <td>Code formatter used to keep code style clean and consistent.</td>
  </tr>
</table>

<hr>

## Features

- Support multiple **YouTube URL formats**, including:
	- Standard video URLs `youtube.com/watch?v=...`;
 	- Shortened URLs `youtu.be/...`;
	- Shorts URLs `youtube.com/shorts/...`;
	- Playlist URLs `youtube.com/playlist?list=...`.
- Allows the user to **select specific videos** to get data on from those available in a playlist.
- Enables the user to **choose any combination** of the following information to retrieve:
	- For **videos**:
		- **Title**;
		- **Duration**;
		- **Views count**;
		- **Likes count**;
		- **Comments count**;
		- **Upload date**;
		- **Uploader**;
		- **Description**;
		- **Chapters**;
		- **Thumbnail** (*sent as a Telegram photo*).
	- For **playlists**:
		- **Title**;
		- **Description**;
		- **Uploader**;
		- **Hidden Videos**;
		- **Total** and **Average** values (*across selected videos*) for:
			- *Duration*, *Views*, *Likes*, and *Comments Count*.
- After showing the selected information, the bot **returns to the information selection menu**, allowing the user to **explore more data** from the same URL *without resending it*.
- Provides **specific commands** to:
	- Fetch **all available information** for a *video* or *playlist*.
	- Retrieve **only the thumbnail** of a video.
- The user can **cancel any operation** or **end the conversation** at any time.

<hr>

## Usage

### Commands

#### Help

- **`/help`**: Gives **general instructions and information** about the bot and how to use it.
- **`/help_url`**: Provides informations about **supported and valid YouTube URL formats**.
- **`/help_infos`**: Lists and clarifies the **available information types** the bot can fetch.
- **`/help_commands`**: Describes the **extra commands** available beyond the main `/start`.

#### Main Conversation

- **`/start`**: Begins an interactive **conversation** with the user, consisting of the following steps:
	- Prompts the user to provide a **Youtube video or playlist URL**.
		- *If the URL is invalid, the bot prompts again*.
  - *If the URL is a playlist*, prompts the user to **choose specific videos** (*or select all/none*).
  	- *If the selection is invalid, the bot prompts again*.
  - Displays an **information selection menu**, including:
  	- Toggleable buttons for each **available information option** (*depending on whether it’s a video or playlist*);
    - A `Select/Deselect All` button to toggle all information options;
    - *If it's a playlist*, a `Select Different Videos` button to select other playlist videos;
    - A `Cancel` button to finish the conversation;
    - A `Done` button to confirm the selection.
  - Once `Done` is selected, the bot **sends the chosen information**.
  - The **menu is resent automatically**, allowing the user to select more data until they cancel or start a new conversation.

#### Extras

- **`/info <URL>`**: Validates the given *YouTube video or playlist URL* and returns **all available information**.
	- *For playlists*, this command fetches only the **playlist-level information**, *not data for each video*.
- **`/thumbnail <URL>`**: Validates a *YouTube video URL*, retrieves its **thumbnail**, and sends it as a **Telegram photo**.

#### Cancel
- **`/cancel`**: Cancels the current conversation or any ongoing bot process at any time.

<hr>

## How to Run

These are the instructions for running the bot locally.
> ℹ️ The bot is already deployed and available on [Telegram](https://t.me/YouTubedlpHelperBot).

### Prerequisites

- Python 3.9+
	```bash
	sudo apt install python3
	```
- pip
	```bash
	sudo apt install python3-pip
	```

### Setup and Run

1. Clone the repository
	```bash
	git clone https://github.com/iz00/youtube-telegram-bot.git
 	cd youtube-telegram-bot
	```
2. (Optional) Create and activate a virtual environment
	```bash
	pip install virtualenv
	python3 -m venv .venv
 	source .venv/bin/activate
	```
3. Install required packages
	```bash
	pip install -r requirements.txt
	```
4. Get and set up the following configuration variables
	- `BOT_TOKEN`: Your Telegram bot token
		- [Create a Telegram bot](https://core.telegram.org/bots/tutorial#obtain-your-bot-token) through [@BotFather](https://t.me/BotFather) and get the token.
	- `YOUTUBE_API_KEY`: Your YouTube Data API key
		- Follow the official [Getting Started](https://developers.google.com/youtube/v3/getting-started#before-you-start) and the [Obtaining Authorization Credentials](https://developers.google.com/youtube/registering_an_application) guides.

   You can set these variables in two ways:
   - Using environment variables:
	  ```bash
	  export BOT_TOKEN="your_bot_token_here"
	  export YOUTUBE_API_KEY="your_api_key_here"
	  ```
     *Optionally, add these lines to your shell config file (e.g., `.bashrc` or `.zshrc`) to persist them*.

   - Hardcoding in [`config.py`](https://github.com/iz00/youtube-telegram-bot/blob/main/config.py):
	 ```python
	 BOT_TOKEN = "your_bot_token_here"
	 YOUTUBE_API_KEY = "your_api_key_here"
	 ```
5. Run the bot
	```bash
	python3 bot.py
	```
6. (Optional) Get a `cookies.txt` file

	If `yt-dlp` returns an error like `Sign in to confirm you’re not a bot.`, it may be solved by providing a `cookies.txt` file.
	- Follow the official yt-dlp guides on [how to get cookies](https://github.com/yt-dlp/yt-dlp/wiki/FAQ#how-do-i-pass-cookies-to-yt-dlp) and [how to get cookies that are not rotated](https://github.com/yt-dlp/yt-dlp/wiki/Extractors#exporting-youtube-cookies).
 	- Place the `cookies.txt` file in the root directory of the project — *the code is already set up to use it automatically*.

	If you still encounter issues, try updating `yt-dlp`:
	```bash
	pip install -U yt-dlp
	```

<hr>

## Future Features and Improvements

- [ ] Allow simultaneous usage by multiple users;
- [ ] Improve playlist video selection flexibility:
	- [ ] Allow selection video ranges like `-5` (*first five videos*) or `5-` (*from fifth to last videos*).
- [ ] Support embedded YouTube URLs;
- [ ] Add download options:
 	- [ ] Video (*e.g., `.mp4`*);
	- [ ] Audio only (*e.g., `.mp3`*);
 	- [ ] Allow users to select start and end timestamps for trimming;
  - [ ] Handle large filesizes by sending download links, instead of direct Telegram uploads.
- [ ] Add feature to extract a frame from a video at a specific second;
- [ ] Fetch and display YouTube channel informations (*e.g. name, subscriber count, total videos, etc*);
- [ ] Add automated tests.

<hr>

## Personal Considerations

### Objective

This project was initially created as the [final project](https://cs50.harvard.edu/x/project/) for [CS50x](https://cs50.harvard.edu/x).
The goal was for it to be a learning experience, going through the full development cycle, from ideia to deployment, and to build a Telegram bot that would actually be usable.

### Key Learnings

- **APIs and Frameworks Integration**: I Learned how to work with tools like `yt-dlp`, `Youtube Data API` and `python-telegram-bot`, and make them all function together;
- **Problem Solving**: Some desired features didn't have straightforward or built-in support, so I had to come up with workarounds. For example, there was no API or framework method for filtering only valid videos in playlists, so the solution was manually validating each video and trying to optimize the process to reduce execution time;
- **User-Centered Design**: I focused on improving user experience, through validations, re-prompts, clear and consistent messages and prioritizing a guided conversation flow over relying solely on individual commands;
- **Code Organization**: I put effort into making the project more readable and maintainable, splitting logic into submodules and using naming and styling conventions. This part seemed way more necessary as the codebase grew and thinking on making future maintenance or collaboration easier.

### Challenges Faced

- **Asynchronous Programming**: Since `python-telegram-bot` is async-based and the goal was to support multiple users interacting with the bot at the same time, it was necessary to handle asynchronous logic;
- **Performance Optimization**: Some operations (like filtering only valid videos in playlists) were slow, so I had to work on optimizations to make the bot feel responsive;
- **Handling Cancellations**: Allowing users to cancel bot operations proved difficult, most likely due to the async nature of the bot and how some long-running tasks were executed;
- **Deployment Issues**: Deploying to a VPS introduced unexpected issues, for example, `yt-dlp` behaving differently than it did locally, requiring a `cookies.txt` file to work properly and frequent updates to avoid errors.

<hr>
